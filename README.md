##### Сценарий
* В RabbitMQ добавляется 100.000 команд (пик в начале)
* При получении команды приложение начинает транзакцию (PostgreSQL 9.6), добавляет запись, отправляет событие в RabbitMQ, коммитит транзакцию
* При получении события оно никак не обрабатывается (просто принимается; видно на пике в конце)

##### Настройки
* Логирование у приложений выключено
* Каждое приложение запускается только в 1 экземляре (1 процесс)
* Я не нашёл как у **symfony/messenger** корректно изменить QoS параметры, поэтому у обоих приложений они оставлены "как есть" (как из коробки настроено, так и работает)
* В **mmasiukevich-service-bus** Изменено количество обрабатываемых одновременно сообщений до 90
* Версия PHP - 7.2
* Для **mmasiukevich-service-bus** дополнительно установлены расширения: raphf, pq, sockets, event

## Тестирование

#### [DigitalOcean](https://www.digitalocean.com/) CPU Optimized Droplet (4 CPUs/8GB)

**symfony/messenger** в начале довольно быстро отправляет сообщения (ощутимо быстрее, чем **mmasiukevich-service-bus**). Но обработка сообщений находится на уровне ~700 сообщений в секунду. В конце, когда сообщения просто принимаются, слегка не дотягивает до ~4.000 сообщений в секунду

![](https://github.com/mmasiukevich/performance-comparison/blob/master/results/cloud/messenger.jpg)

**mmasiukevich-service-bus** в начале проигрывает в заполнении очереди, но когда дело доходит до обработки сообщений показывает результат на уровне ~1.650 сообщений в секунду. В конце на пике получается около ~6.000 сообщений в секунду

![](https://github.com/mmasiukevich/performance-comparison/blob/master/results/cloud/service-bus.jpg)

#### PC на базе i5/16GB (SSD)

Как и в случае с облаком, **symfony/messenger** опережает в начальном заполнении очереди. Обработка сообщений находится на уровне ~230 сообщений в секунду. В конце немногим меньше ~4.000 сообщений в секунду

![](https://github.com/mmasiukevich/performance-comparison/blob/master/results/pc/messenger.jpg)

**mmasiukevich-service-bus** обрабатывает сообщения со скоростью ~750 в секунду. На завершающем этапе скорость вырастает до 7.800 сообщений в секунду.
Общее время, затраченное на обработку, в разы меньше.

![](https://github.com/mmasiukevich/performance-comparison/blob/master/results/pc/service-bus.jpg)
